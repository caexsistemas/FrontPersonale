
<div class="card mt-6">
  <div *ngIf="view == 'create' || view == 'update'">
      <div class="card-header">
          <h5 class="modal-title">
              <p class="title-modal" *ngIf="view == 'create'">{{title}}</p>
              <p class="title-modal" *ngIf="view == 'update'">{{title}}</p>
              <button type="button" class="btn btn-primary btn-close" (click)="closeDialog()" aria-label="Close"
                  style="position: absolute;left: 90%;top: 2%;font-size: 12px;">
                  <span aria-hidden="true">&times;</span>
              </button>
          </h5>
      </div>
      <div class="card-body">
          <mat-dialog-content>
              <form *ngIf="view == 'create' || view == 'update'" [formGroup]="formCreate">

                  <div class="row">
                      <div class="col-md-4">
                          <mat-form-field class="example-full-width">
                              <mat-label>Nombre de la capacitación </mat-label>
                              <input matInput formControlName="lear_name" [readonly]="view == 'update'" required>
                          </mat-form-field>
                      </div>
                      <div class="col-md-4">
                          <mat-form-field class="example-full-width">
                              <mat-label>Fecha de ejecución:</mat-label>
                              <input matInput formControlName="lear_fec_eje" type="date" [readonly]="view == 'update'" required>
                          </mat-form-field>
                      </div>
                    
                  </div>
                  <div class="row mt-2">
                    <div class="col-md-6">
                      <mat-form-field class="example-full-width">
                        <mat-label>Link de evaluación</mat-label>
                        <input matInput formControlName="lear_link" [readonly]="view == 'update'" required>
                    </mat-form-field>
                    </div>
                  </div>
                  <hr>
                  <div class="row mt-3">
                      <div class="col-md-4">
                          <mat-form-field class="example-full-width">
                          <mat-label>Linea de Negocio:</mat-label>
                          <mat-select formControlName="receiver" (ngModelChange)="onSelectArea($event)" multiple required>
                              <mat-option *ngFor="let idet of businessLine" [value]="idet.ls_codvalue" [disabled]="view == 'update'">
                                {{idet.description}}
                              </mat-option>
                            </mat-select>
                          </mat-form-field>
                      </div>
                     
                      <div class="col-md-4" *ngIf="checkArea">
                          <mat-form-field class="example-full-width">
                          <mat-label>Area:</mat-label>
                          <mat-select formControlName="receiver2" (ngModelChange)="onSelectCargo($event)" multiple >
                              <mat-option *ngFor="let idet of area" [value]="idet.idArea" [disabled]="view == 'update'">
                                {{idet.area}}
                              </mat-option>
                            </mat-select>
                          </mat-form-field>
                      </div>
                      <div class="col-md-4" *ngIf="checkCargo">
                          <mat-form-field class="example-full-width">
                          <mat-label>Cargo:</mat-label>
                          <mat-select formControlName="receiver3" multiple (ngModelChange)="onSelectPerson($event)"  >
                              <mat-option *ngFor="let idet of cargo" [value]="idet.idPosition" [disabled]="view == 'update'">
                                {{idet.cargo}}
                              </mat-option>
                            </mat-select>
                          </mat-form-field>
                      </div>
                   
                        <div class="col-md-4" *ngIf="checkPerson">
                         
                          <mat-form-field class="example-chip-list">
                            <mat-chip-list #chipList aria-label="Usuario selection">
                              <mat-chip
                                *ngFor="let user of selectedUsers"
                                [selectable]="true"
                                [removable]="true"
                                (removed)="remove(user)">
                                {{user.name}}
                                <mat-icon matChipRemove>cancel</mat-icon>
                              </mat-chip>
                              <input
                                placeholder="Selecciona usuario..."
                                #userInput
                                [formControl]="userCtrl"
                                [matAutocomplete]="auto"
                                [matChipInputFor]="chipList"
                                [matChipInputSeparatorKeyCodes]="separatorKeysCodes"
                                (matChipInputTokenEnd)="add($event)">
                            </mat-chip-list>
                            <mat-autocomplete #auto="matAutocomplete" (optionSelected)="selected($event)" >
                              <mat-option *ngFor="let user of filteredUsers | async" [value]="user" [disabled]="view == 'update'">
                                {{user.name}}
                              </mat-option>
                            </mat-autocomplete>
                          </mat-form-field>
                          


                       
                        </div>
                       
                  </div>
                  <!-- <div class="row mt-3" *ngIf="view == 'create'">
                     

                    </div> -->
                    <div class="row mt-3" *ngIf="view == 'create'">
                      <div class="col-md-4">
                        <label>Adjuntar Portada (Imagen):</label>
                        <input formControlName="file_sp" class="form-control" type="file" (change)="seleccionarImg($event)" accept="image/*" required>
                      </div>
                      <div class="col-md-6">
                        <label>Adjuntar Documento de Soporte:</label>
                        <input formControlName="file_sp_doc" class="form-control" type="file" (change)="seleccionarArchivo($event)"
                          multiple required>
                      </div>
                      <div class="col-md-6" *ngIf="view == 'update'">
                        <dt>Documentos de Soporte:</dt>
                        <dd>
                          <ul>
                            <li *ngFor="let archivo of selection.file_sp_doc; let i = index;">
                              <a href="{{archivo}}" target="_blank">Download {{i+1}}</a>
                            </li>
                          </ul>
                        </dd>
                      </div>
                    </div>
                    
                    <div class="row mt-3">
                      <div class="col-md-12">
                        <mat-form-field class="example-full-width">
                          <mat-label> Descripción de capacitación </mat-label>
                          <textarea matInput formControlName="lear_desc" [readonly]="view == 'update'" required></textarea>
                        </mat-form-field>
                      </div>
                     
                    </div>
              </form>
          </mat-dialog-content>
          <div mat-dialog-actions>
              <div class="text-center col-12">
                  <button *ngIf="view == 'update'" mat-button class="btn btn-success"
                      (click)="onSubmitUpdate()">Actualizar</button>

                  <button *ngIf="view == 'create'" mat-button class="btn btn-success"
                      (click)="onSubmi()">Guardar</button>

                  <button mat-button class="btn btn-danger" (click)="closeDialog()">Cancelar</button>
              </div>
          </div>
      </div>
  </div>

  <div class="background-suave" *ngIf="view == 'view'">
    <div class="modal-header">
        <h5 class="modal-title">{{title}}</h5>
        <button type="button" class="btn btn-primary btn-close" (click)="closeDialog()" aria-label="Close">
            <span aria-hidden="true">&times;</span>
        </button>
    </div>
      
    <mat-dialog-content style="min-width: 1200px;">
      <div class="row mt-2">

        <div class="col-md-6">
          <dd>
            <ul>
              <!-- <ng-container *ngFor="let archivo of selection.file_sp; let i = index;">
                <ng-container *ngIf="esImagen(archivo); else imagenNot">
                  <li>
                    <img [src]="archivo" alt="Imagen{{i+1}}" />
                  </li>
                </ng-container>
                <ng-template #imagenNot>
                  <li>
                    <img mat-card-image style="display: block; margin: 0px auto; opacity: 0.3;" src="assets/img/404.gif" alt="Photo of a Shiba Inu">
                  </li>
                </ng-template>
                
              </ng-container> -->
              <ng-container class="contenedor-flexible">
                <ng-container *ngIf="selectionImg.file_sp; else imagenNot">
                  <li>
                    <img class="tu-imagen" [src]="selectionImg.file_sp" alt="Imagen" />
                  </li>
                </ng-container>
                <ng-template #imagenNot>
                  <li>
                    <img class="tu-imagen" mat-card-image style="display: block; margin: 0px auto; opacity: 0.3;" src="assets/img/404.gif" alt="Photo of a Shiba Inu">
                  </li>
                </ng-template>
                
              </ng-container>
            </ul>
          </dd>
        </div>
    
          <div class="col-md-6" style="padding-left: 10%;" >
          <div>
            <dt class="textHeader">{{meeting.mee_name}}</dt>
            <dd class="textCenter mt-3" [class.shortText]="text">{{meeting.mee_desc}}</dd>
          </div>
    
          <mat-card-content>
            <p class="textHeader mt-3">Consultar Documentos Adjuntos</p>
            <ul class="textCenter">
              <li *ngFor="let archivo of selection.file_sp_doc; let i = index;">
                <a href="{{archivo}}" target="_blank">{{ archivo.split('_').pop() }}</a>
              </li>
            </ul>
          </mat-card-content>

          <mat-card-content>
            <p class="textHeader mt-3">Link de evaluación</p>
            <ul class="textCenter">
                <a href="{{meeting.mee_link}}" target="_blank"> Link evaluación</a>
            </ul>
          </mat-card-content>

          <mat-card-content>
            <div *ngIf="check_date">
              <p class="textHeader mt-3">Fecha fin vigencia</p>
              <dt class="textHeader">{{meeting.mee_fec_fin}}</dt>
            </div>
          </mat-card-content>
          <div>

          </div>
          <div *ngIf="viewDataActua">

          <mat-accordion class="example-headers-align" >
            <mat-expansion-panel>
              <mat-expansion-panel-header>
                <mat-panel-title>
                  Personal 
                </mat-panel-title>
                <mat-panel-description>
                  Lista de personal actualización
                </mat-panel-description>
                <mat-icon>account_circle</mat-icon>
              </mat-expansion-panel-header>
          
              <div class="mat-elevation-z8">
                <table mat-table [dataSource]="dataSource" matSort class="table-large table-responsive-lg"
                  *ngIf="contenTable.length > 0">
          
                <ng-container matColumnDef="document">
                  <th mat-header-cell *matHeaderCellDef mat-sort-header (click)="openc()">Documento </th>
                  <td mat-cell *matCellDef="let element"> {{element.document }} </td>
                </ng-container>
        
                  <ng-container matColumnDef="idPersonale">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header (click)="openc()">empleado</th>
                    <td mat-cell *matCellDef="let element"> {{element.name }} </td>
                  </ng-container>
          
                  <ng-container matColumnDef="view_state">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header (click)="openc()">Estado</th>
                    <td mat-cell *matCellDef="let element"> {{element.state_view}} </td>
                  </ng-container>

                  <ng-container matColumnDef="date_view">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header (click)="openc()">Fecha de Visualización</th>
                    <td mat-cell *matCellDef="let element"> {{element.date_view}} </td>
                  </ng-container>
          
                  <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                  <tr mat-row *matRowDef="let element; columns: displayedColumns;"></tr>
                </table>
                <mat-paginator [length]="dataSource.data.length" [pageSize]="10" [pageSizeOptions]="[5, 10, 25, 100]"></mat-paginator>
          
              </div>
          
             
            </mat-expansion-panel>
            
          </mat-accordion>
        </div>


        </div>
      </div>
    </mat-dialog-content>

</div>